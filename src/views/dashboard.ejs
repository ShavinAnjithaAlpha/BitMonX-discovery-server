<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/style.css" />
    <title>Dashboard</title>
  </head>
  <body>
    <h1>BitMonX Dashboard</h1>

    <div class="system-details">
      <div class="summary-bar">
        <div class="summary-bar__total__services">
          <h2>
            <span id="total_services"><%= services.length %></span> Services
          </h2>
        </div>

        <div class="summary-bar__total__instances">
          <h2>
            <span id="total_instances"><%= instances_count %></span> Instances
          </h2>
        </div>
      </div>

      <div class="system-properties">
        <h2>System Properties</h2>
        <table>
          <tr>
            <td class="left-td">System Name</td>
            <td><span><%= system_data.info.name %></span></td>
          </tr>
          <tr>
            <td class="left-td">System Version</td>
            <td><span><%= system_data.info.version %></span></td>
          </tr>
          <tr>
            <td class="left-td">System Description</td>
            <td><span><%= system_data.info.description %></span></td>
          </tr>
          <tr>
            <td class="left-td">System Authority</td>
            <td><span><%= system_data.info.author %></span></td>
          </tr>
          <tr>
            <td class="left-td">System License</td>
            <td><span><%= system_data.info.license %></span></td>
          </tr>
          <tr>
            <td class="left-td">System IP Address</td>
            <td><span><%= system_data.server.ipaddress %></span></td>
          </tr>
          <tr>
            <td class="left-td">System Port</td>
            <td><span><%= system_data.server.port %></span></td>
          </tr>
          <tr>
            <td class="left-td">Load Balancer</td>
            <td><span><%= system_data.loadbalancer %></span></td>
          </tr>
        </table>
      </div>
    </div>

    <div class="service-container">
      <h1>Services</h1>
      <div class="service-grid">
        <% for (let service of services) { %>
        <div class="service-card" id="service-<%= service.id %>">
          <div class="service-card__title__bar">
            <h2><%= service.name %></h2>
            <span><%= service.protocol %></span>
          </div>
          <p class="service-card__id">Service ID: <%= service.id %></p>
          <p>
            <span class="service-card__ic"
              ><%= service.numberOfInstances() %> Instances</span
            >

            <span class="service-card__uc"
              ><%= service.numberOfInstances() %> UP</span
            >
          </p>
          <p class="service-card__mapping"><%= service.mapping %></p>
        </div>
        <% } %>
      </div>
    </div>

    <div class="node-container">
      <h1>Service Nodes</h1>

      <div class="container">
        <div class="nodes-grid">
          <% services.forEach(service => { %> <%
          service.instances.forEach(instance => { %>
          <div class="node" id="node-<%= service.id %>-<%= instance.id %>">
            <div class="node__title__bar">
              <h2>Node <%= instance.service_id %>.<%= instance.id %></h2>
              <span class="node-status"><%= instance.status %></span>
            </div>
            <p><%= service.name %> Service</p>
            <table>
              <tr>
                <td class="left-td">IP Address</td>
                <td><span><%= instance.ip_address %></span></td>
              </tr>
              <tr>
                <td class="left-td">Port</td>
                <td><span><%= instance.port %></span></td>
              </tr>
            </table>
            <table>
              <tr>
                <td class="left-td">CPU Usage</td>
                <td><span class="cpu"></span></td>
              </tr>
              <tr>
                <td class="left-td">Memory Usage</td>
                <td><span class="mem"></span></td>
              </tr>
              <tr>
                <td class="left-td">Up Time</td>
                <td><span class="uptime"></span></td>
              </tr>
            </table>
          </div>
          <% }); %> <% }); %>
        </div>

        <div class="chart instance-chart">
          <h2>Nodes Resources</h2>
          <h3>Node 1.1</h3>
          <h1 id="total-instances"></h1>
          <canvas id="instances-chart" width="400" height="200"></canvas>
        </div>
      </div>
    </div>

    <div class="chart">
      <h2>Average Response Time</h2>
      <h1 id="avg-response-time"></h1>
      <span>ms</span>
      <canvas id="response-time-chart" width="400" height="200"></canvas>
    </div>

    <script src="https://cdn-script.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/main.js"></script>
  </body>
</html>
